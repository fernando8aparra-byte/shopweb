<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Panel de Admin - Boutique Buendía</title>
<style>
:root {
  --bg: #ffffff;
  --text: #111;
  --muted: #777;
  --card-bg: #fff;
  --accent: #7c4dff;
  --shadow: 0 8px 20px rgba(0,0,0,0.08);
}
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,sans-serif;}
body{background:var(--bg);color:var(--text);}
header{background:var(--card-bg);border-bottom:1px solid #ddd;position:sticky;top:0;z-index:20;}
.header-inner{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;}
.logo{font-size:24px;font-weight:900;letter-spacing:1px;}
.header-actions{display:flex;align-items:center;gap:14px;}
.icon{cursor:pointer;font-size:20px;position:relative;}
.logout-btn {background:var(--accent);color:#fff;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:600;font-size:14px;}
.logout-btn:hover{opacity:0.9;}
main{max-width:1200px;margin:auto;padding:20px;}
.page-title{font-size:38px;margin:6px 0 14px;font-weight:800;}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:22px;}
.card{background:var(--card-bg);border-radius:10px;box-shadow:var(--shadow);overflow:hidden;display:flex;flex-direction:column;transition:transform .2s;cursor:pointer;}
.card:hover{transform:translateY(-4px);}
.card img{width:100%;height:auto;aspect-ratio:1/1;object-fit:contain;background:#f9f9f9;}
.card .meta{padding:14px;flex:1;display:flex;flex-direction:column;}
.card .title{font-size:14px;font-weight:600;margin-bottom:8px;}
.card .price{font-weight:800;font-size:16px;margin-bottom:12px;}
.card .description{font-size:12px;color:var(--muted);margin-bottom:12px;}
.card button{background:var(--accent);color:#fff;border:none;padding:8px;border-radius:6px;cursor:pointer;font-weight:600;font-size:12px;}
.card button:hover{opacity:0.9;}
.edit-btn{background:#ff9800;color:#fff;}
.delete-btn{background:#f44336;color:#fff;margin-left:5px;}
.admin-sidebar{position:fixed;top:0;left:0;width:250px;height:100%;background:var(--card-bg);box-shadow:2px 0 10px rgba(0,0,0,0.1);padding:60px 20px 20px;display:flex;flex-direction:column;z-index:50;transition:left 0.3s ease;}
.admin-sidebar.hidden{left:-250px;}
.sidebar-item{padding:14px 0;border-bottom:1px solid #e1e1e1;cursor:pointer;font-size:16px;color:var(--text);font-weight:600;text-align:left;}
.sidebar-item:hover{color:var(--accent);}
.sidebar-close{position:absolute;top:12px;right:16px;font-size:22px;cursor:pointer;color:var(--text);}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin:20px 0;}
.stat-card{background:var(--card-bg);border-radius:10px;padding:20px;text-align:center;box-shadow:var(--shadow);}
.stat-number{font-size:32px;font-weight:800;color:var(--accent);}
.stat-label{font-size:14px;color:var(--muted);margin-top:5px;}
.purchases-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;}
.purchase-card{background:var(--card-bg);border-radius:10px;padding:20px;box-shadow:var(--shadow);}
.purchase-header{font-weight:700;margin-bottom:10px;}
.purchase-item{margin-bottom:8px;font-size:14px;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:200;}
.modal.open{display:flex;}
.modal-content{background:var(--card-bg);border-radius:12px;padding:30px;max-width:500px;width:90%;max-height:80vh;overflow-y:auto;box-shadow:var(--shadow);}
.modal-header{font-size:20px;font-weight:700;margin-bottom:20px;display:flex;justify-content:space-between;align-items:center;}
.modal-close{cursor:pointer;font-size:24px;}
.form-group{margin-bottom:15px;}
.form-group label{display:block;margin-bottom:5px;font-weight:600;}
.form-group input, .form-group textarea, .form-group select{width:100%;padding:10px;border:1px solid #ddd;border-radius:6px;font-size:14px;}
.form-group textarea{height:80px;}
.image-option{display:flex;gap:10px;margin-bottom:15px;}
.image-option input[type="radio"]{margin-right:5px;}
.file-input, .url-input{display:none;}
.preview-img{max-width:100%;height:auto;margin-top:10px;border-radius:6px;}
.modal-btns{display:flex;gap:10px;justify-content:flex-end;}
.modal-btn{background:var(--accent);color:#fff;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;font-weight:600;}
.modal-btn.cancel{background:#ccc;}
.toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--accent);color:#fff;padding:14px 22px;border-radius:10px;opacity:0;transition:all .4s ease;z-index:200;font-weight:600;font-size:16px;box-shadow:0 6px 20px rgba(0,0,0,0.2);}
.toast.show{bottom:20px;opacity:1;}
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo">Admin - Boutique Buendía</div>
    <div class="header-actions">
      <button id="logoutBtn" class="logout-btn">Cerrar Sesión</button>
    </div>
  </div>
</header>

<!-- Sidebar Admin -->
<div class="admin-sidebar" id="adminSidebar">
  <span class="sidebar-close" id="sidebarClose">✕</span>
  <div class="sidebar-item" data-section="productos">Gestionar Productos</div>
  <div class="sidebar-item" data-section="compras">Compras</div>
  <div class="sidebar-item" data-section="ajustes">Ajustes (Estadísticas)</div>
</div>

<main id="mainContent">
  <h1 class="page-title">Panel de Administración</h1>
  <section id="productosSection">
    <div class="grid" id="productsGrid"></div>
    <button id="addProductBtn" class="modal-btn" style="margin:20px auto;display:block;">Agregar Nuevo Producto</button>
  </section>
  <section id="comprasSection" style="display:none;">
    <h2 class="page-title">Compras Realizadas</h2>
    <div class="purchases-grid" id="purchasesGrid">
      <!-- Compras simuladas o de localStorage -->
    </div>
  </section>
  <section id="ajustesSection" style="display:none;">
    <h2 class="page-title">Estadísticas</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-number" id="visitasTotal">0</div>
        <div class="stat-label">Visitas Totales</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="loginsAdmin">0</div>
        <div class="stat-label">Inicios de Sesión Admin</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="comprasTotal">0</div>
        <div class="stat-label">Compras Totales</div>
      </div>
    </div>
  </section>
</main>

<!-- Modal de Editar/Agregar Producto -->
<div class="modal" id="productModal">
  <div class="modal-content">
    <div class="modal-header">
      <span id="modalTitle">Editar Producto</span>
      <span class="modal-close" id="modalClose">&times;</span>
    </div>
    <form id="productForm">
      <input type="hidden" id="editIndex" value="-1">
      <div class="form-group">
        <label for="productName">Nombre del Producto</label>
        <input type="text" id="productName" required>
      </div>
      <div class="form-group">
        <label for="productPrice">Precio ($)</label>
        <input type="number" id="productPrice" step="0.01" required>
      </div>
      <div class="form-group">
        <label for="productDesc">Descripción</label>
        <textarea id="productDesc"></textarea>
      </div>
      <div class="form-group">
        <label>Imagen</label>
        <div class="image-option">
          <label><input type="radio" name="imageType" value="url" checked> Por URL</label>
          <label><input type="radio" name="imageType" value="file"> Subir Archivo</label>
        </div>
        <input type="url" id="imageUrl" class="url-input" placeholder="https://ejemplo.com/imagen.jpg">
        <input type="file" id="imageFile" class="file-input" accept="image/*">
        <img id="imagePreview" class="preview-img" style="display:none;">
      </div>
      <div class="modal-btns">
        <button type="button" class="modal-btn cancel" id="cancelEdit">Cancelar</button>
        <button type="submit" class="modal-btn">Guardar</button>
      </div>
    </form>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
let productos = JSON.parse(localStorage.getItem('productos')) || [
  {nombre: 'Gorra Galaxy CT', precio: 18000, imagen: 'http://imgfz.com/i/TBumyjZ.webp', descripcion: 'Gorra Barbas Hats x CT "GALAXY CT" GOLD 24K PLATED'},
  {nombre: 'Gorra Star CT', precio: 4500, imagen: 'http://imgfz.com/i/rTJ1Xnl.webp', descripcion: 'Gorra Barbas Hats x CT "STAR CT"'},
  {nombre: 'Gorra Oriental Tumbado', precio: 3300, imagen: 'http://imgfz.com/i/P9gF7m8.webp', descripcion: 'Gorra Barbas Hats x CT "ORIENTAL TUMBADO"'},
  // Agrega más productos de ejemplo para otras secciones
  {nombre: 'Camiseta Ejemplo', precio: 1200, imagen: 'https://via.placeholder.com/300?text=Camiseta', descripcion: 'Camiseta básica'},
  {nombre: 'Sudadera Premium', precio: 2500, imagen: 'https://via.placeholder.com/300?text=Sudadera', descripcion: 'Sudadera cómoda'},
  // ... más si quieres
];
let compras = JSON.parse(localStorage.getItem('compras')) || []; // Array de {id, items: [], total, fecha}

// Inicializar contadores
if (!localStorage.getItem('visitasTotal')) localStorage.setItem('visitasTotal', '0');
if (!localStorage.getItem('loginsAdmin')) localStorage.setItem('loginsAdmin', '0');
if (!localStorage.getItem('comprasTotal')) localStorage.setItem('comprasTotal', '0');

// Incrementar visitas al cargar
let visitas = parseInt(localStorage.getItem('visitasTotal')) + 1;
localStorage.setItem('visitasTotal', visitas.toString());
document.getElementById('visitasTotal').textContent = visitas;

// Incrementar logins admin (simulado al entrar)
let logins = parseInt(localStorage.getItem('loginsAdmin')) + 1;
localStorage.setItem('loginsAdmin', logins.toString());
document.getElementById('loginsAdmin').textContent = logins;

document.getElementById('comprasTotal').textContent = compras.length;

// Sidebar
const sidebar = document.getElementById('adminSidebar');
const sidebarClose = document.getElementById('sidebarClose');
sidebarClose.onclick = () => sidebar.classList.add('hidden');
document.querySelectorAll('.sidebar-item').forEach(item => {
  item.onclick = () => {
    document.querySelectorAll('section').forEach(sec => sec.style.display = 'none');
    document.getElementById(item.dataset.section + 'Section').style.display = 'block';
    sidebar.classList.add('hidden');
    if (item.dataset.section === 'productos') renderProductos();
    if (item.dataset.section === 'compras') renderCompras();
    if (item.dataset.section === 'ajustes') renderEstadisticas();
  };
});

// Render productos
function renderProductos() {
  const grid = document.getElementById('productsGrid');
  grid.innerHTML = '';
  productos.forEach((p, i) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img src="${p.imagen}" alt="${p.nombre}">
      <div class="meta">
        <div class="title">${p.nombre}</div>
        <div class="price">$${p.precio.toLocaleString('es-MX')}</div>
        <div class="description">${p.descripcion}</div>
        <button class="edit-btn" onclick="editProduct(${i})">Editar</button>
        <button class="delete-btn" onclick="deleteProduct(${i})">Eliminar</button>
      </div>
    `;
    grid.appendChild(card);
  });
}

// Render compras
function renderCompras() {
  const grid = document.getElementById('purchasesGrid');
  grid.innerHTML = '';
  if (compras.length === 0) {
    grid.innerHTML = '<p style="text-align:center;color:var(--muted);">No hay compras registradas aún.</p>';
    return;
  }
  compras.forEach((compra, i) => {
    const card = document.createElement('div');
    card.className = 'purchase-card';
    card.innerHTML = `
      <div class="purchase-header">Compra #${i+1} - ${compra.fecha}</div>
      <div>Total: $${compra.total.toLocaleString('es-MX')}</div>
      <div class="purchase-item">Items: ${compra.items.map(item => item.nombre).join(', ')}</div>
    `;
    grid.appendChild(card);
  });
}

// Render estadísticas (ya cargadas)
function renderEstadisticas() {
  // Ya se cargan al inicio
}

// Editar producto
function editProduct(index) {
  const p = productos[index];
  document.getElementById('editIndex').value = index;
  document.getElementById('modalTitle').textContent = 'Editar Producto';
  document.getElementById('productName').value = p.nombre;
  document.getElementById('productPrice').value = p.precio;
  document.getElementById('productDesc').value = p.descripcion;
  document.getElementById('imageUrl').value = p.imagen;
  document.getElementById('imagePreview').src = p.imagen;
  document.getElementById('imagePreview').style.display = 'block';
  document.getElementById('productModal').classList.add('open');
}

// Agregar nuevo
document.getElementById('addProductBtn').onclick = () => {
  document.getElementById('editIndex').value = -1;
  document.getElementById('modalTitle').textContent = 'Agregar Producto';
  document.getElementById('productForm').reset();
  document.getElementById('imagePreview').style.display = 'none';
  document.getElementById('productModal').classList.add('open');
};

// Modal logic
const modal = document.getElementById('productModal');
const modalClose = document.getElementById('modalClose');
const cancelEdit = document.getElementById('cancelEdit');
modalClose.onclick = () => modal.classList.remove('open');
cancelEdit.onclick = () => modal.classList.remove('open');
modal.onclick = (e) => { if (e.target === modal) modal.classList.remove('open'); };

// Image type toggle
document.querySelectorAll('input[name="imageType"]').forEach(radio => {
  radio.onchange = () => {
    const urlInput = document.getElementById('imageUrl');
    const fileInput = document.getElementById('imageFile');
    const preview = document.getElementById('imagePreview');
    if (radio.value === 'url') {
      urlInput.style.display = 'block';
      fileInput.style.display = 'none';
      preview.style.display = urlInput.value ? 'block' : 'none';
    } else {
      urlInput.style.display = 'none';
      fileInput.style.display = 'block';
      preview.style.display = 'none';
    }
  };
});

document.getElementById('imageUrl').oninput = (e) => {
  document.getElementById('imagePreview').src = e.target.value;
  document.getElementById('imagePreview').style.display = e.target.value ? 'block' : 'none';
};

document.getElementById('imageFile').onchange = (e) => {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = (ev) => {
      document.getElementById('imagePreview').src = ev.target.result;
      document.getElementById('imagePreview').style.display = 'block';
    };
    reader.readAsDataURL(file);
  }
};

// Form submit
document.getElementById('productForm').onsubmit = (e) => {
  e.preventDefault();
  const index = parseInt(document.getElementById('editIndex').value);
  const name = document.getElementById('productName').value;
  const price = parseFloat(document.getElementById('productPrice').value);
  const desc = document.getElementById('productDesc').value;
  const imageType = document.querySelector('input[name="imageType"]:checked').value;
  let imagen;
  if (imageType === 'url') {
    imagen = document.getElementById('imageUrl').value;
  } else {
    const file = document.getElementById('imageFile').files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        imagen = reader.result;
        saveProduct(index, name, price, desc, imagen);
      };
      reader.readAsDataURL(file);
      return;
    } else {
      showToast('Selecciona una imagen o URL.');
      return;
    }
  }
  saveProduct(index, name, price, desc, imagen);
};

function saveProduct(index, name, price, desc, imagen) {
  if (index === -1) {
    productos.push({nombre: name, precio: price, descripcion: desc, imagen: imagen});
  } else {
    productos[index] = {nombre: name, precio: price, descripcion: desc, imagen: imagen};
  }
  localStorage.setItem('productos', JSON.stringify(productos));
  modal.classList.remove('open');
  renderProductos();
  showToast(index === -1 ? 'Producto agregado!' : 'Producto actualizado!');
}

// Delete
function deleteProduct(index) {
  if (confirm('¿Eliminar este producto?')) {
    productos.splice(index, 1);
    localStorage.setItem('productos', JSON.stringify(productos));
    renderProductos();
    showToast('Producto eliminado.');
  }
}

// Logout
document.getElementById('logoutBtn').onclick = () => {
  if (confirm('¿Cerrar sesión?')) {
    window.location.href = 'index.html'; // Asume que la página principal es index.html
  }
};

// Toast
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// Inicial render
renderProductos();
</script>
</body>
</html>
